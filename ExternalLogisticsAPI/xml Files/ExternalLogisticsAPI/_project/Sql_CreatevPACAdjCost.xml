<Sql TableName="CreatevPACAdjCost" SqlScriptPriority="1" CustomScript="#CDATA">
    <CDATA name="CustomScript"><![CDATA[ IF EXISTS
(
	SELECT *
	FROM SYS.views
	WHERE name = 'vPACAdjCost' AND SCHEMA_ID = SCHEMA_ID('dbo')
)
DROP VIEW [dbo].[vPACAdjCost]	
GO
CREATE VIEW vPACAdjCost AS
select cost.CompanyID,
	　 cost.FinPeriodID,
	 　MAX(isnull(cost.FinPtdCOGS,0) - isnull(Cost.FinPtdCostAdjusted,0)) as FinPtdCOGS,
	   MAX(cost.FinPtdQtySales) as FinPtdQtySales,
	   MAX(p.PACUnitCost) as PACUnitCost,
	   MAX(cost.InventoryID) as InventoryID,
	   MAX(cost.FinPtdQtySales * p.PACUnitCost) as PACCOGS,
	   MAX(s.SiteID) as SiteID,
	   MAX((isnull(cost.FinPtdCOGS,0) - isnull(Cost.FinPtdCostAdjusted,0)) - (cost.FinPtdQtySales * p.PACUnitCost)) as COGSADJ
from INItemCostHist cost
left join INSite s on cost.CompanyID = s.CompanyID
				  and cost.SiteID = s.SiteID
inner join InventoryItem i on cost.CompanyID = i.CompanyID
						  and cost.InventoryID = i.InventoryID
left join vPACUnitCost p on cost.CompanyID = p.companyid
						 and cost.InventoryID = p.InventoryID
						 and cost.FinPeriodID = p.FinPeriodID
group by cost.FinPeriodID,cost.SiteID,cost.InventoryID,cost.CompanyID having SUM(cost.FinPtdCOGS) != 0]]></CDATA>
</Sql>